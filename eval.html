<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Eval Page</title>
        <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>

    <body>
        <div class="navbar-container">
            <div class="project-title">ITEC4020//Project Evaluation</div>
            <nav class="navbar">
                <div class="nav-frame">
                    <div class="nav-item"><a href="profiles.html">Profiles</a></div>
                    <div class="nav-item"><a href="index.html">Introduction</a></div>
                    <div class="nav-item"><a href="eval.html">Evaluation</a></div>
                              </div>
            </nav>
            <div class="api-status">
                <div class="api-status-pill">
                    <span class="status-text">API Connection Online</span>
                    <span class="status-indicator"></span>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="text-side">
                <div class="title" style="margin-left: 10px;">Tech Stack and Data</div>
                <div class="divider" style="margin-left: 10px;"></div>
                <div class="body-text typewriter3" style="margin-left: 10px;">
                    MongoDB:
                    MongoDB stores all the data used to evaluate ChatGPT's accuracy such as test questions, expected answers, and performance metrics. Its flexible structure makes it easy to save and retrieve the data our website and display it through charts and comparisons.
                    <br><br>
                    Node.js:
                    Node.js runs the backend of our project, handling requests from the website, connecting to MongoDB, and communicating with the ChatGPT API. It manages the workflow of sending prompts, saving results, and returning processed data to the front end. 
                    <br><br>
                    ChatGPT API:
                    The ChatGPT API generates the responses our system evaluates. It provides the output that our project compares against the chosen datasets, allowing the website to display accuracy scores, performance trends, and other visual insights.    
                    <br><br> 
                    Datasets:
                    The datasets span History, Social Science, and Computer Security, covering factual historical information, concepts about society and human behaviour, and foundational cybersecurity principles. These topics help evaluate ChatGPT's accuracy across both general and technical domains.
                </div>
            </div>

            <div class="right-box" style="margin-right: -70px;">
                <div class="right-box-title">Live Messages</div>
                <div class="right-box-divider"></div>
                <div class="right-box-inner"></div>
            </div>
        </div>
    </body>
    <script src="script.js"></script>

<div class="grid-container">
    <!-- Computer Security Section -->
    <div class="chart-container">
      <div class="subject-header compsec">Computer Security</div>
      <div class="chart-title">Accuracy</div>
      <canvas id="compsecAccuracy"></canvas>
    </div>

    <div class="chart-container">
      <div class="subject-header compsec">Computer Security</div>
      <div class="chart-title">Response Times</div>
      <canvas id="compsecResponseTime"></canvas>
      <div class="avg-display">
        <div class="avg-label">Average Response Time</div>
        <div>
          <span class="avg-value" id="compsecAvg">-</span>
          <span class="avg-unit">ms</span>
        </div>
      </div>
    </div>

    <!-- History Section -->
    <div class="chart-container">
      <div class="subject-header history">History</div>
      <div class="chart-title">Accuracy</div>
      <canvas id="historyAccuracy"></canvas>
    </div>

    <div class="chart-container">
      <div class="subject-header history">History</div>
      <div class="chart-title">Response Times</div>
      <canvas id="historyResponseTime"></canvas>
      <div class="avg-display" style="border-left-color: #f5576c;">
        <div class="avg-label">Average Response Time</div>
        <div>
          <span class="avg-value" id="historyAvg">-</span>
          <span class="avg-unit">ms</span>
        </div>
      </div>
    </div>

    <!-- Social Studies Section -->
    <div class="chart-container">
      <div class="subject-header social">Social Studies</div>
      <div class="chart-title">Accuracy</div>
      <canvas id="socialAccuracy"></canvas>
    </div>

    <div class="chart-container">
      <div class="chart-header social">Social Studies</div>
      <div class="chart-title">Response Times</div>
      <canvas id="socialResponseTime"></canvas>
      <div class="avg-display" style="border-left-color: #4facfe;">
        <div class="avg-label">Average Response Time</div>
        <div>
          <span class="avg-value" id="socialAvg">-</span>
          <span class="avg-unit">ms</span>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Computer Security Accuracy Chart
    const compsecAccuracyChart = new Chart(document.getElementById('compsecAccuracy'), {
      type: 'bar',
      data: {
        labels: ['Correct', 'Incorrect'],
        datasets: [{
          label: 'Computer Security',
          data: [0, 0],
          backgroundColor: [
            'rgba(102, 126, 234, 0.6)',
            'rgba(118, 75, 162, 0.6)'
          ],
          borderColor: [
            'rgba(102, 126, 234, 1)',
            'rgba(118, 75, 162, 1)'
          ],
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 10 }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    // Computer Security Response Time Chart
    const compsecResponseTimeChart = new Chart(document.getElementById('compsecResponseTime'), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Response Time (ms)',
          data: [],
          borderColor: 'rgba(102, 126, 234, 1)',
          backgroundColor: 'rgba(102, 126, 234, 0.2)',
          borderWidth: 2,
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Time (ms)' }
          },
          x: {
            title: { display: true, text: 'Question #' }
          }
        }
      }
    });

    // History Accuracy Chart
    const historyAccuracyChart = new Chart(document.getElementById('historyAccuracy'), {
      type: 'bar',
      data: {
        labels: ['Correct', 'Incorrect'],
        datasets: [{
          label: 'History',
          data: [0, 0],
          backgroundColor: [
            'rgba(240, 147, 251, 0.6)',
            'rgba(245, 87, 108, 0.6)'
          ],
          borderColor: [
            'rgba(240, 147, 251, 1)',
            'rgba(245, 87, 108, 1)'
          ],
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 10 }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    // History Response Time Chart
    const historyResponseTimeChart = new Chart(document.getElementById('historyResponseTime'), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Response Time (ms)',
          data: [],
          borderColor: 'rgba(245, 87, 108, 1)',
          backgroundColor: 'rgba(245, 87, 108, 0.2)',
          borderWidth: 2,
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Time (ms)' }
          },
          x: {
            title: { display: true, text: 'Question #' }
          }
        }
      }
    });

    // Social Studies Accuracy Chart
    const socialAccuracyChart = new Chart(document.getElementById('socialAccuracy'), {
      type: 'bar',
      data: {
        labels: ['Correct', 'Incorrect'],
        datasets: [{
          label: 'Social Studies',
          data: [0, 0],
          backgroundColor: [
            'rgba(79, 172, 254, 0.6)',
            'rgba(0, 242, 254, 0.6)'
          ],
          borderColor: [
            'rgba(79, 172, 254, 1)',
            'rgba(0, 242, 254, 1)'
          ],
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 10 }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    // Social Studies Response Time Chart
    const socialResponseTimeChart = new Chart(document.getElementById('socialResponseTime'), {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Response Time (ms)',
          data: [],
          borderColor: 'rgba(79, 172, 254, 1)',
          backgroundColor: 'rgba(79, 172, 254, 0.2)',
          borderWidth: 2,
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Time (ms)' }
          },
          x: {
            title: { display: true, text: 'Question #' }
          }
        }
      }
    });

    // Helper function to calculate average
    function calculateAverage(arr) {
      if (!arr || arr.length === 0) return 0;
      const sum = arr.reduce((a, b) => a + b, 0);
      return Math.round(sum / arr.length);
    }

    // Load chart data from API
    async function loadChartData() {
      try {
        const response = await fetch('http://localhost:3000/api/results');
        const data = await response.json();

        // Update Computer Security Accuracy
        compsecAccuracyChart.data.datasets[0].data = [
          data.compsecCorrect || 0,
          data.compsecIncorrect || 0
        ];
        compsecAccuracyChart.update();

        // Update Computer Security Response Time
        const compsecLabels = [];
        const compsecTimes = data.compsecResponseTime || [];
        for (let i = 0; i < compsecTimes.length; i++) {
          compsecLabels.push('Q' + (i + 1));
        }
        compsecResponseTimeChart.data.labels = compsecLabels;
        compsecResponseTimeChart.data.datasets[0].data = compsecTimes;
        compsecResponseTimeChart.update();
        
        // Update Computer Security Average
        const compsecAvg = calculateAverage(compsecTimes);
        document.getElementById('compsecAvg').textContent = compsecAvg;

        // Update History Accuracy
        historyAccuracyChart.data.datasets[0].data = [
          data.historyCorrect || 0,
          data.historyIncorrect || 0
        ];
        historyAccuracyChart.update();

        // Update History Response Time
        const historyLabels = [];
        const historyTimes = data.historyResponseTime || [];
        for (let i = 0; i < historyTimes.length; i++) {
          historyLabels.push('Q' + (i + 1));
        }
        historyResponseTimeChart.data.labels = historyLabels;
        historyResponseTimeChart.data.datasets[0].data = historyTimes;
        historyResponseTimeChart.update();
        
        // Update History Average
        const historyAvg = calculateAverage(historyTimes);
        document.getElementById('historyAvg').textContent = historyAvg;

        // Update Social Studies Accuracy
        socialAccuracyChart.data.datasets[0].data = [
          data.socialCorrect || 0,
          data.socialIncorrect || 0
        ];
        socialAccuracyChart.update();

        // Update Social Studies Response Time
        const socialLabels = [];
        const socialTimes = data.socialResponseTime || [];
        for (let i = 0; i < socialTimes.length; i++) {
          socialLabels.push('Q' + (i + 1));
        }
        socialResponseTimeChart.data.labels = socialLabels;
        socialResponseTimeChart.data.datasets[0].data = socialTimes;
        socialResponseTimeChart.update();
        
        // Update Social Studies Average
        const socialAvg = calculateAverage(socialTimes);
        document.getElementById('socialAvg').textContent = socialAvg;

        console.log('Chart data loaded:', data);
      } catch (error) {
        console.error('Error loading chart data:', error);
      }
    }

    // Load initial data
    loadChartData();


  </script>
</body>
</html>
